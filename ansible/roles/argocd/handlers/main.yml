- name: "Export credentials manifests in the logs directory (if verbose)."
  template:
    src: templates/repository.credential.yml.j2
    dest: "{{ workspace_directory }}/logs/repo.creds-{{ repo_credential.name }}.yml"
    force: True
  vars:
    creds:
      name: "{{ repo_credential.name | default('undefined') }}"
      repo_url: "{{ repo_credential.repo_url | default('undefined') }}"
      repo_username: "{{ repo_credential.repo_username | default('undefined') }}"
      repo_password: "{{ repo_credential.repo_password | default('undefined') }}"
      repo_ssh_key: "{{ repo_credential.repo_ssh_key | default('undefined') }}"
  with_items: "{{ applications.repositories_creds | default([]) }}"
  loop_control:
    loop_var: repo_credential
  when: (verbose_exec | default(False) | bool)
  listen: export repocreds manifests